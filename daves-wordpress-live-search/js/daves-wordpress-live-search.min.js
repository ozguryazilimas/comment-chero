var LiveSearch={resultsElement:"",searchBoxes:"",activeRequests:[],callbacks:[],addCallback:function(a,b){if(this.callbacks[a]===undefined){this.callbacks[a]=[]}return this.callbacks[a].push(b)},invokeCallbacks:function(a,c){var b;if(this.callbacks[a]!==undefined){for(b in this.callbacks[a]){c=this.callbacks[a][b](c)}}}};LiveSearch.init=function(){jQuery("body").append('<ul class="search_results dwls_search_results"></ul>');this.resultsElement=jQuery("ul").filter(".dwls_search_results");this.resultsElement.hide();LiveSearch.searchBoxes=jQuery("input").filter("[name='s']");LiveSearch.searchBoxes.keyup(LiveSearch.handleKeypress);LiveSearch.searchBoxes.focus(LiveSearch.hideResults);if(!LiveSearch.searchBoxes.outerHeight){alert(DavesWordPressLiveSearchConfig.outdatedJQuery)}LiveSearch.searchBoxes.parents("form").attr("autocomplete","off");jQuery("html").click(LiveSearch.hideResults);LiveSearch.searchBoxes.add(this.resultsElement).click(function(a){a.stopPropagation()});jQuery(window).resize(function(){var a=LiveSearch.resultsElement.is(":visible");LiveSearch.positionResults(this);if(!a){LiveSearch.resultsElement.hide()}})};LiveSearch.positionResults=function(){var b;var c=jQuery("input:focus").first();if(c.size()>0){var a=c.offset();a.left+=parseInt(DavesWordPressLiveSearchConfig.xOffset,10);a.top+=parseInt(DavesWordPressLiveSearchConfig.yOffset,10);this.resultsElement.css("left",a.left);this.resultsElement.css("top",a.top);this.resultsElement.css("display","block");switch(DavesWordPressLiveSearchConfig.resultsDirection){case"up":b=a.top-this.resultsElement.height();break;case"down":b=a.top+LiveSearch.searchBoxes.outerHeight();break;default:b=a.top+LiveSearch.searchBoxes.outerHeight()}this.resultsElement.css("top",b+"px")}};LiveSearch.handleAJAXResults=function(f){var a;LiveSearch.activeRequests.pop();if(f){resultsSearchTerm=f.searchTerms;if(resultsSearchTerm!=jQuery("input:focus").first().val()){if(LiveSearch.activeRequests.length===0){LiveSearch.removeIndicator()}return}var h=jQuery("ul").filter(".dwls_search_results").children("input[name=query]").val();if(h!==""&&resultsSearchTerm==h){if(LiveSearch.activeRequests.length===0){LiveSearch.removeIndicator()}return}var d=jQuery("ul").filter(".dwls_search_results");d.empty();d.append('<input type="hidden" name="query" value="'+resultsSearchTerm+'" />');if(f.results.length===0){LiveSearch.hideResults()}else{for(var b=0;b<f.results.length;b++){a=f.results[b];if(a.post_title!==undefined){var g="";var c;if(DavesWordPressLiveSearchConfig.showThumbs=="true"&&a.attachment_thumbnail){c="post_with_thumb"}else{c=""}g+='<li class="daves-wordpress-live-search_result '+c+'">';if(DavesWordPressLiveSearchConfig.showThumbs=="true"&&a.attachment_thumbnail){g+='<img src="'+a.attachment_thumbnail+'" class="post_thumb" />'}g+='<a href="'+a.permalink+'" class="daves-wordpress-live-search_title">'+a.post_title+"</a>";if(a.post_price!==undefined){g+='<p class="price">'+a.post_price+"</p>"}if(DavesWordPressLiveSearchConfig.showExcerpt=="true"&&a.post_excerpt){g+='<p class="excerpt clearfix">'+a.post_excerpt+"</p>"}if(f.displayPostMeta){g+='<p class="meta clearfix daves-wordpress-live-search_author" id="daves-wordpress-live-search_author">Posted by '+a.post_author_nicename+'</p><p id="daves-wordpress-live-search_date" class="meta clearfix daves-wordpress-live-search_date">'+a.post_date+"</p>"}g+='<div class="clearfix"></div></li>';d.append(g)}}if(a.show_more!==undefined&&a.show_more&&DavesWordPressLiveSearchConfig.showMoreResultsLink=="true"){d.append('<div class="clearfix search_footer"><a href="'+DavesWordPressLiveSearchConfig.blogURL+"/?s="+resultsSearchTerm+'">'+DavesWordPressLiveSearchConfig.viewMoreText+"</a></div>")}d.find("li.daves-wordpress-live-search_result").bind("click.dwls",function(){window.location.href=jQuery(this).find("a.daves-wordpress-live-search_title").attr("href")});LiveSearch.showResults()}if(LiveSearch.activeRequests.length===0){LiveSearch.removeIndicator()}}};LiveSearch.handleKeypress=function(b){var c=0;var a=LiveSearch.searchBoxes.val();setTimeout(function(){LiveSearch.runQuery(a)},c)};LiveSearch.runQuery=function(e){var h=jQuery("input:focus");var f=h.val();var b;var d;if(f===""||f.length<DavesWordPressLiveSearchConfig.minCharsToSearch){LiveSearch.hideResults();LiveSearch.removeIndicator()}else{LiveSearch.displayIndicator();while(LiveSearch.activeRequests.length>0){d=LiveSearch.activeRequests.pop();d.abort()}var c={};var a=h.parents("form").find("input:not(:submit),select,textarea");for(b in a){if(a.hasOwnProperty(b)&&b%1===0){var g=jQuery(a[b]);c[g.attr("name")]=g.val()}}c.action="dwls_search";d=jQuery.get(DavesWordPressLiveSearchConfig.ajaxURL,c,LiveSearch.handleAJAXResults,"json");LiveSearch.activeRequests.push(d)}};LiveSearch.hideResults=function(){var a=jQuery("ul").filter(".dwls_search_results:visible");if(a.size()>0){LiveSearch.invokeCallbacks("BeforeHideResults");switch(DavesWordPressLiveSearchConfig.resultsDirection){case"up":a.fadeOut();break;case"down":a.slideUp();break;default:a.slideUp();break}LiveSearch.invokeCallbacks("AfterHideResults")}};LiveSearch.showResults=function(){var a=jQuery("ul").filter(".dwls_search_results:hidden");if(a.size()>0){LiveSearch.invokeCallbacks("BeforeShowResults");this.positionResults();switch(DavesWordPressLiveSearchConfig.resultsDirection){case"up":jQuery("ul").filter(".dwls_search_results:hidden").fadeIn();break;case"down":jQuery("ul").filter(".dwls_search_results:hidden").slideDown();break;default:jQuery("ul").filter(".dwls_search_results:hidden").slideDown();break}LiveSearch.invokeCallbacks("AfterShowResults")}};LiveSearch.displayIndicator=function(){if(jQuery(".search_results_activity_indicator").size()===0){var e=jQuery("input:focus").first();var b=e.offset();jQuery("body").append('<span id="search_results_activity_indicator" class="search_results_activity_indicator" />');var a={outer:Math.ceil((e.height()*0.9)/2)};a.inner=Math.floor(a.outer*0.29);jQuery(".search_results_activity_indicator").css("position","absolute").css("z-index",9999);var c=(b.top+((e.outerHeight()-e.innerHeight())/2)+"px");jQuery(".search_results_activity_indicator").css("top",c);var d=(b.left+e.outerWidth()-((a.outer+a.inner)*2)-2)+"px";jQuery(".search_results_activity_indicator").css("left",d);Spinners.create(".search_results_activity_indicator",{radii:[a.inner,a.outer],color:"#888888",dashWidth:4,dashes:8,opacity:0.8,speed:0.7}).play()}};LiveSearch.removeIndicator=function(){jQuery(".search_results_activity_indicator").remove()};jQuery(function(){LiveSearch.init()});